<script>
    const URL = "127.0.0.1";
    // const URL = "122.9.163.105";
    const TERMINAL_PORT = "9002";
    // const TERMINAL_PORT = "4000"
  </script>




<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./out.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/axios/1.2.2/axios.js"></script>
    <link rel="stylesheet" href="./node_modules/xterm/css/xterm.css" />
    <script src="./node_modules/xterm/lib/xterm.js"></script>
    <script src="./node_modules/xterm-addon-attach/lib/xterm-addon-attach.js"></script>
    <link rel="stylesheet" href="intellij-light.css">
    <link rel="stylesheet" href="github-markdown.css">
    <script src="./marked.min.js"></script>

</head>



<body class="bg-[#F1F2F3]">
    <div class="rounded-full w-12 h-12 fixed bottom-24 right-14 bg-purple-400">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9 5.25h.008v.008H12v-.008z" />
          </svg>
          
          
    </div>
    <div class="rounded-full bg-black w-12 h-12 fixed bottom-40 right-14"></div>
    <div id="nav" class="w-full h-16 bg-[#fff] pt-3 pl-10 fixed shadow-sm">
        <div class="markdown-body float-left"><h1 tabindex="-1" dir="auto"><code>Terminal-Lab</code> 终端实验室</h1></div>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 mt-[2px] hover:text-purple-400 hover:cursor-pointer">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 12.75a.75.75 0 110-1.5.75.75 0 010 1.5zM12 18.75a.75.75 0 110-1.5.75.75 0 010 1.5z" />
          </svg>
    </div>
    <div id="content" class="w-full h-max ">
        <div id="left_container" class="w-[50%] h-screen float-left pt-20 overflow-hidden">
            <div class="term_label">
                <div class="term_label_l">刷新终端</div>
                <div class="term_label_r">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="term_label_svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3" />
                        </svg>
                </div>
            </div>

            <div class="term_label">
                <div class="term_label_l">下载本题</div>
                <div class="term_label_r">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="term_label_svg">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 13.5l3 3m0 0l3-3m-3 3v-6m1.06-4.19l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                    </svg>                      
                </div>
            </div>

            <div class="term_label">
                <div class="term_label_l">查看排行</div>
                <div class="term_label_r">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="term_label_svg">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0" />
                    </svg>
                          
                                         
                </div>
            </div>

            <div class="term_label float-right mr-[2%]">
                <div class="term_label_l">所有题目</div>
                <div class="term_label_r">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="term_label_svg">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
                        </svg>
                                          
                </div>
            </div>
            
            <div id="terminal_container" class=" h-[100%] w-[95%] bg-black m-auto mt-14" style="border:10px solid black;">
                <div id="terminal" ></div>
            </div>
        </div>
        <div id="right_container" class="w-[50%]  h-screen float-right pt-20 ">

            <div id="document" class=" h-[85%] w-[95%]  m-auto mt-2">
                <div class="w-full h-12 ">
                    <div id="实验要求" class="label"><div class="txt w-28 h-8 m-auto">实验要求</div></div>
                    <div id="测试用例" class="label opacity-60"><div class="txt w-28 h-8 m-auto">测试用例</div></div>
                    <div id="评论区" class="label opacity-60"><div class="txt w-28 h-8 m-auto">评论区</div></div>
                    <script>
                        let label_arr = document.getElementsByClassName('label');
                        for(enu in label_arr){
                            label_arr[enu].onclick = function(){
                                this.className = "label"
                                for(enu2 in label_arr){
                                    if(label_arr[enu2].id!=this.id){
                                        label_arr[enu2].className="label opacity-60"
                                    }
                                }
                                get_exps(exp_num, this.id+".md")
                            }
                        }
                    </script>
                </div>
                <div id="document_container" class=" w-full h-full bg-white  pt-5" >
                    <div id="document_container_wrap" class="pl-10 pr-5 h-full overflow-y-scroll">
                        <div id="document_content" class="markdown-body">

                        </div>
                        <div class="w-full h-10">
    
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <div id="foot"  class="w-full h-20 fixed bg-[#fff] bottom-0 pt-5 pr-5 pl-10 border-t-[1px] border-[#e4e4e4]">
        <div id="pre" onclick="pre_exp()" class="foot_btn">上一题</div>
        <div class="foot_btn w-96">题目列表</div>
        <div id="next" onclick="next_exp()" class="foot_btn float-right">下一题</div>
        <div class="foot_btn_orange">答案检测</div>

    </div>
</body>
</html>

<script>
    let exp_num = 0
</script>

<script>
    function next_exp(){
        exp_num ++;
        try{
            get_exps(exp_num, "实验要求.md")
            console.log(exp_num)
        }
        catch(err){
            exp_num --;
        }
        init_term()
    }

    function pre_exp(){
        if(exp_num>0){
            exp_num --;
        }
        else{
            alert("这是一个个实验")
        }
        get_exps(exp_num, "实验要求.md")
        console.log(exp_num)
        init_term()
    }
</script>

<script>
    let exps_arr
    function get_exps(exp_num, doc_name){
        axios.get('http://'+URL+':9001/get_exps', {
        }).then(response =>{
            exps_arr = response.data.exps
            make_page(exps_arr[exp_num], doc_name)
        })
    }
</script>

<script>

</script>

<script>
    function make_page(exp, doc_name){
        let content = document.getElementById('document_content');
        axios.get('http://'+URL+':9001/get_content', {
            params: {
                exp: exp,
                doc_name: doc_name,
            }
        }).then(response =>{
            content.innerHTML = marked.parse(response.data.content)
        })
    }
</script>


<script>
    get_exps(exp_num, "实验要求.md")
</script>

<script>
    function init_term(){
        if(document.getElementsByClassName('terminal')){
            // socket.close()
            console.log("term!")
            let tem = document.getElementById('terminal')
            document.getElementById('terminal_container').removeChild(tem)
            tem = document.createElement('div')
            tem.id="terminal"
            document.getElementById('terminal_container').appendChild(tem)
        }
        var pid = ''
        // xterm官网实例
        // 创建terminal对象
        var term = new Terminal();
        // open对应id内容
        term.open(document.getElementById('terminal'));
        let terchildchild = document.getElementById('terminal').firstChild.firstChild;
        let terchild = document.getElementById('terminal');
        terchildchild.style.overflowY = "hidden";
        terchild.style.overflow = "hidden";
        terchild.style.zIndex = 10;
        // 写入初始信息
        // term.write('请稍后\x1B[1;32m正在创建连接终端中\x1B[0m $ ')
        fetch('http://'+URL+":"+TERMINAL_PORT+"/"+"terminals",{method:"POST"})
        .then((response)=>response.text(response))
        .then((response)=>{
        let content = document.getElementById('content');
            let socket = new WebSocket('ws://'+URL+":"+TERMINAL_PORT+"/"+"terminals"+"/"+response);
            socket.onopen = function(){
            }
            const attachAddon  = new AttachAddon.AttachAddon(socket);
            term.loadAddon(attachAddon)
        });

    }
    init_term()

  </script>